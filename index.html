<!DOCTYPE html>
<html>
<head>
    <title>–ì–æ—Ä—å–∫–æ–≤ –ß–∞–π Lottie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1a1a; color: white; padding: 20px; font-family: Arial; }
        h1 { text-align: center; color: #00ff88; margin-bottom: 30px; }
        .upload { text-align: center; padding: 20px; background: #2a2a2a; border-radius: 10px; margin-bottom: 30px; }
        #fileInput { padding: 10px; border: 2px dashed #00ff88; border-radius: 5px; background: #3a3a3a; color: white; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #2a2a2a; border-radius: 10px; padding: 15px; text-align: center; }
        .player { width: 100%; height: 200px; background: #111; border-radius: 5px; margin-bottom: 10px; }
        .controls button { padding: 8px 12px; font-weight: bold; border: none; background: #00ff88; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<h1>üé¨ –ì–æ—Ä—å–∫–æ–≤ –ß–∞–π Lottie</h1>

<div class="upload">
    <h3>–ó–∞–≥—Ä—É–∑–∏ –Ω–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é:</h3>
    <input type="file" id="fileInput" accept=".json">
</div>

<div class="grid" id="container"></div>

<script>
    const container = document.getElementById("container");
    const animations = [];

    // ---------- –†–ï–ù–î–ï–† –û–î–ù–û–ô –ê–ù–ò–ú–ê–¶–ò–ò ----------
    function renderAnimation(name, data) {
        const id = "anim_" + Math.random().toString(36).slice(2);

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <h4>${name}</h4>
            <div class="player" id="${id}"></div>
            <div class="controls">
                <button onclick="animations['${id}'].play()">‚ñ∂Ô∏è</button>
                <button onclick="animations['${id}'].pause()">‚è∏Ô∏è</button>
                <button onclick="animations['${id}'].stop(); animations['${id}'].play()">üîÑ</button>
            </div>
        `;
        container.appendChild(card);

        animations[id] = lottie.loadAnimation({
            container: document.getElementById(id),
            renderer: "svg",
            loop: true,
            autoplay: true,
            animationData: data
        });
    }

    // ---------- –°–û–•–†–ê–ù–ï–ù–ò–ï ----------
    function saveLocal(name, data) {
        const stored = JSON.parse(localStorage.getItem("lottieStore") || "{}");
        stored[name] = data;
        localStorage.setItem("lottieStore", JSON.stringify(stored));
    }

    // ---------- –ó–ê–ì–†–£–ó–ö–ê –ó–ê–ì–†–£–ñ–ï–ù–ù–û–ì–û json ----------
    document.getElementById("fileInput").addEventListener("change", e => {
        const file = e.target.files[0];
        if (!file) return;

        const r = new FileReader();
        r.onload = () => {
            const json = JSON.parse(r.result);
            renderAnimation(file.name, json);
            saveLocal(file.name, json);
        };
        r.readAsText(file);
    });

    // ---------- DRAG AND DROP ----------
    document.addEventListener("dragover", e => e.preventDefault());
    document.addEventListener("drop", e => {
        e.preventDefault();
        [...e.dataTransfer.files].forEach(file => {
            if (!file.name.endsWith(".json")) return;
            const r = new FileReader();
            r.onload = () => {
                const json = JSON.parse(r.result);
                renderAnimation(file.name, json);
                saveLocal(file.name, json);
            };
            r.readAsText(file);
        });
    });

    // ---------- –ó–ê–ì–†–£–ó–ö–ê –ò–ó /animations/ ----------
    async function loadFromGitHubFolder() {
        try {
            const repoUrl = window.location.pathname.replace("index.html", "");
            const api = `https://api.github.com/repos/${location.pathname.split('/')[1]}/${location.pathname.split('/')[2]}/contents/animations`;
            
            const list = await fetch(api).then(r => r.json());

            for (const file of list) {
                if (!file.name.endsWith(".json")) continue;
                const data = await fetch(file.download_url).then(r => r.json());
                renderAnimation(file.name, data);
            }
        } catch (e) {
            console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–ø–∫—É animations", e);
        }
    }

    // ---------- –ó–ê–ì–†–£–ó–ö–ê LOCALSTORAGE ----------
    function loadLocal() {
        const stored = JSON.parse(localStorage.getItem("lottieStore") || "{}");
        Object.entries(stored).forEach(([name, data]) => {
            renderAnimation(name, data);
        });
    }

    // ---------- –°–¢–ê–†–¢ ----------
    loadLocal();
    loadFromGitHubFolder();
</script>

</body>
</html>
